\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{draftwatermark}[2006/06/30 R1.0]
\RequirePackage{everypage}
\RequirePackage{graphicx}
\RequirePackage{color}

\newif\if@sc@wm@first
\@sc@wm@firstfalse

\DeclareOption{firstpage}{%
  \@sc@wm@firsttrue}
\ProcessOptions

\newlength\sc@wm@fontsize
%% defaults
\def\sc@wm@angle{45}
\def\sc@wm@lightness{0.8}
\def\sc@wm@scale{1}
\setlength\sc@wm@fontsize{5cm}
\def\sc@wm@text{DRAFT}

\newcommand\SetWatermarkAngle[1]{%
  \def\sc@wm@angle{#1}}
\newcommand\SetWatermarkLightness[1]{%
  \def\sc@wm@lightness{#1}}
\newcommand\SetWatermarkFontSize[1]{%
  \setlength\sc@wm@fontsize{#1}}
\newcommand\SetWatermarkScale[1]{%
  \def\sc@wm@scale{#1}}
\newcommand\SetWatermarkText[1]{%
  \def\sc@wm@text{#1}}

\newcommand\sc@watermark{%
  \setlength{\@tempdimb}{.5\paperwidth}%
  \setlength{\@tempdimc}{-.5\paperheight}%
  \put(\strip@pt\@tempdimb,\strip@pt\@tempdimc){%
    \makebox(0,0){\rotatebox{\sc@wm@angle}{%
        \scalebox{\sc@wm@scale}{%
        \textcolor[gray]{\sc@wm@lightness}{
          \fontsize{\sc@wm@fontsize}{1.2\sc@wm@fontsize}
          \selectfont{\sc@wm@text}}}}}}}

\newcommand\sc@wm@print[1]{%
  \setbox\@tempboxa\vbox to\z@{% 
    \vskip-1in \moveleft1in \vbox{% 
      \hbox to \z@{% 
        #1\hss}}\vss} 
  \dp\@tempboxa\z@  
  \box\@tempboxa}

\if@sc@wm@first
\AddThispageHook{\sc@wm@print{\sc@watermark}}
\else
\AddEverypageHook{\sc@wm@print{\sc@watermark}}
\fi
